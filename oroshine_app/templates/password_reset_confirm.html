<!-- templates/password_reset_confirm.html -->
{% load static %}

{% block title %}Set New Password ‚Äì OroShine{% endblock %}

{% block content %}
<section class="reset-section">
  <div class="reset-container">

    {% if validlink %}
    <!-- ========== VALID TOKEN ‚Üí Show password form ========== -->
    <div class="reset-icon">üîê</div>
    <h2 class="reset-title">Set a New Password</h2>
    <p class="reset-subtitle">
      Choose a strong password for your account.
    </p>

    <!-- Form errors (non-field) -->
    {% if form.non_field_errors %}
      <div class="alert alert-error">
        {% for error in form.non_field_errors %}{{ error }}{% endfor %}
      </div>
    {% endif %}

    <form method="post" class="reset-form" novalidate>
      {% csrf_token %}

      <!-- New password -->
      <div class="form-group">
        <label for="id_new_password1" class="form-label">New Password</label>
        <input
          type="password"
          name="new_password1"
          id="id_new_password1"
          class="form-control {% if form.new_password1.errors %}is-invalid{% endif %}"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          required
          autocomplete="new-password"
        />
        {% if form.new_password1.errors %}
          <div class="invalid-feedback">
            {% for error in form.new_password1.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Confirm password -->
      <div class="form-group">
        <label for="id_new_password2" class="form-label">Confirm New Password</label>
        <input
          type="password"
          name="new_password2"
          id="id_new_password2"
          class="form-control {% if form.new_password2.errors %}is-invalid{% endif %}"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          required
          autocomplete="new-password"
        />
        {% if form.new_password2.errors %}
          <div class="invalid-feedback">
            {% for error in form.new_password2.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Password hints -->
      <div class="hints-card">
        <p class="hints-title">Password requirements:</p>
        <ul class="hints-list">
          <li>At least <strong>8 characters</strong> long</li>
          <li>Cannot be entirely <strong>numeric</strong></li>
          <li>Cannot be a <strong>common</strong> password</li>
          <li>Cannot be too similar to your <strong>username or email</strong></li>
        </ul>
      </div>

      <!-- Submit -->
      <button type="submit" class="btn btn-primary btn-full">
        Update Password
      </button>
    </form>

    {% else %}
    <!-- ========== INVALID / EXPIRED TOKEN ========== -->
    <div class="reset-icon expired-icon">
      <div class="circle">‚ö†</div>
    </div>

    <h2 class="reset-title">Link Expired</h2>
    <p class="reset-subtitle">
      This password reset link is invalid or has already been used.
      Reset links expire after <strong>24 hours</strong> for your security.
    </p>

    <a href="{% url 'password_reset' %}" class="btn btn-primary btn-full">
      Request a New Link
    </a>
    {% endif %}

    <!-- Back to login -->
    <p class="reset-footer">
      <a href="{% url 'custom_login' %}">‚Üê Back to Login</a>
    </p>

  </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
  .reset-section {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f0f4f8;
    padding: 40px 16px;
  }
  .reset-container {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    padding: 48px 40px 36px;
    width: 100%;
    max-width: 460px;
    text-align: center;
  }
  .reset-icon { font-size: 48px; margin-bottom: 12px; }
  .reset-title {
    font-size: 24px;
    font-weight: 700;
    color: #1a1a2e;
    margin: 0 0 8px;
  }
  .reset-subtitle {
    font-size: 14px;
    color: #6b7280;
    margin: 0 0 28px;
    line-height: 1.5;
  }

  /* Expired icon ‚Äì orange warning */
  .expired-icon .circle {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #f59e0b, #d97706);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 38px;
    color: #fff;
    margin-bottom: 16px;
  }

  /* Form */
  .reset-form .form-group { text-align: left; margin-bottom: 18px; }
  .reset-form .form-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 6px;
  }
  .reset-form .form-control {
    width: 100%;
    padding: 12px 14px;
    border: 1.5px solid #d1d5db;
    border-radius: 8px;
    font-size: 14px;
    color: #1f2937;
    background: #fafafa;
    box-sizing: border-box;
    transition: border-color 0.2s;
  }
  .reset-form .form-control:focus {
    border-color: #1a73e8;
    background: #fff;
    outline: none;
    box-shadow: 0 0 0 3px rgba(26,115,232,0.15);
  }
  .reset-form .form-control.is-invalid { border-color: #ef4444; }
  .invalid-feedback {
    color: #ef4444;
    font-size: 12px;
    margin-top: 6px;
    text-align: left;
  }

  /* Hints card */
  .hints-card {
    background: #f0f7ff;
    border: 1px solid #bfdbfe;
    border-radius: 8px;
    padding: 14px 16px;
    margin-bottom: 22px;
    text-align: left;
  }
  .hints-title {
    font-size: 12px;
    font-weight: 600;
    color: #1e40af;
    margin: 0 0 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .hints-list {
    list-style: none;
    padding: 0; margin: 0;
  }
  .hints-list li {
    font-size: 12.5px;
    color: #374151;
    padding: 3px 0;
  }
  .hints-list li::before { content: "‚úì "; color: #16a34a; font-weight: 700; }

  /* Button */
  .btn-full {
    width: 100%;
    padding: 13px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(135deg, #1a73e8, #0d47a1);
    color: #fff;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: block;
    text-align: center;
    transition: opacity 0.2s;
  }
  .btn-full:hover { opacity: 0.9; }

  .reset-footer {
    margin-top: 24px;
    font-size: 13px;
  }
  .reset-footer a {
    color: #1a73e8;
    text-decoration: none;
    font-weight: 500;
  }
  .reset-footer a:hover { text-decoration: underline; }

  /* Alert */
  .alert { padding: 10px 14px; border-radius: 8px; font-size: 13px; margin-bottom: 16px; text-align: left; }
  .alert-error { background: #fef2f2; color: #991b1b; border: 1px solid #fca5a5; }
</style>
{% endblock %}